<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <arg name="weights" default="$(find-pkg-share rgbd_proc)/config/weights/disp_refine/linknet_resnet18_encoder_depth_3.pth" />
  <arg name="left_namespace" default="/luxonis/oak/left" />
  <arg name="right_namespace" default="/luxonis/oak/right" />
  <arg name="device" default="cpu" />
  <arg name="vis" default="false" />
  <arg name="output_cloud_topic" default="/points" />

  <!-- Depth refinement node -->
  <node pkg="rgbd_proc" exec="depth_refinement.py" name="depth_refinement" output="screen">
    <param name="weights" value="$(var weights)" />
    <param name="device" value="$(var device)" />
    <param name="max_msgs_delay" value="0.05" />
    <param name="max_age" value="0.5" />
    <param name="vis" value="$(var vis)" />

    <remap from="/camera_left/image_rect" to="$(var left_namespace)/image_rect" />
    <remap from="/camera_left/camera_info" to="$(var left_namespace)/camera_info" />
    <remap from="/camera_right/image_rect" to="$(var right_namespace)/image_rect" />
    <remap from="/depth_in" to="/luxonis/oak/stereo/image_raw/depth" />
    <remap from="/depth_refined" to="/depth_refined" />
  </node>

  <!-- Depth filtering -->
  <node pkg="rgbd_proc" exec="depth_filter.py" name="depth_filter" output="screen">
    <param name="fov_filter.enabled" value="true" />
    <param name="fov_filter.min_angle" value="-15.0" />
    <param name="fov_filter.max_angle" value="15.0" />

    <param name="median_filter.enabled" value="true" />
    <param name="median_filter.kernel_size" value="5" />

    <remap from="/depth" to="/depth_refined" />
    <remap from="/camera_info" to="/luxonis/oak/stereo/camera_info" />
    <remap from="/filtered_depth" to="/depth_refined_filtered" />
  </node>

  <!-- Publish point cloud from depth image -->
  <node pkg="depth_image_proc" exec="point_cloud_xyzrgb_node" name="point_cloud_xyz_node" output="screen">
<!--    <remap from="depth_registered/image_rect" to="/depth_refined" />-->
    <remap from="depth_registered/image_rect" to="/depth_refined_filtered" />
    <remap from="rgb/image_rect_color" to="$(var left_namespace)/image_rect" />
    <remap from="rgb/camera_info" to="$(var left_namespace)/camera_info" />
    <remap from="points" to="$(var output_cloud_topic)" />

    <param name="approximate_sync" value="true" />
    <param name="queue_size" value="10" />
    <param name="output_frame" value="camera_front" />
  </node>
</launch>
